
(function(){var a=/(\u000d\u000a|\u000a|\u000d|\u0085\u2028|\u2029)/gm;var b={getSelection:function(){var b=this.jquery?this[0]:this;return("selectionStart"in b&&function(){var c=b.selectionEnd-b.selectionStart;var d={start:b.selectionStart,end:b.selectionEnd,length:c,text:b.value.substr(b.selectionStart,c)};if(b.tagName.toLowerCase()=="textarea"){var f=d.row=0;b.value.substr(0,d.start).replace(a,function(){d.row++;f=arguments[2]});d.col=f?d.start-f-1:d.start}return d}||document.selection&&function(){b.focus();var c=document.selection.createRange();if(c===null){return{start:0,end:0,length:0}}var d=b.createTextRange();var f=d.duplicate();d.moveToBookmark(c.getBookmark());f.setEndPoint("EndToStart",d);var g={start:f.text.length,end:f.text.length+c.text.length,length:c.text.length,text:c.text};if(b.tagName.toLowerCase()=="textarea"){var h=row=0;b.value.substr(0,g.start).replace(a,function(){row++;h=arguments[2]});g.row=row;g.col=h?g.start-h-2:g.start;var i=f.duplicate();var j=f.getBookmark();if(i.findText("\r",0,536870912+131072)){i.setEndPoint("EndToStart",d);if(i.text==""){g.col=0;g.row++}}}return g}||function(){return null})()},setSelection:function(){var a=this.jquery?this[0]:this;var b=arguments.length>0&&(typeof arguments[0]=="string"&&((arguments[0]==""||arguments[0]=="none")&&[-1,0]||(arguments[0]=="*"||arguments[0]=="all")&&[0,-1]||(arguments[0]=="<"||arguments[0]=="tostart")&&[0,null]||(arguments[0]==">"||arguments[0]=="toend")&&[null,-1]||(arguments[0]=="^"||arguments[0]=="start")&&[0,0]||(arguments[0]=="$"||arguments[0]=="end")&&[null,-1]||(arguments[0]=="|"||arguments[0]=="center")&&["|","|"])||typeof arguments[0]=="object"&&(("start"in arguments[0]||"end"in arguments[0])&&[arguments[0]["start"]||null,arguments[0]["end"]||null]||"pos"in arguments[0]&&[arguments[0]["pos"],arguments[0]["pos"]]||null||typeof arguments[0][0]!="undefined"&&typeof arguments[0][1]!="undefined"&&arguments[0])||arguments.length==2&&[arguments[0],arguments[1]])||[null,null];var c={current:null,start:0,end:-1};if(typeof b[0]=="string"){b[0]=b[0]in c?c[b[0]]:null}if(typeof b[1]=="string"){b[1]=b[1]in c?c[b[1]]:null}return("selectionStart"in a&&function(){a.focus();a.selectionStart=b[0]===null?a.selectionStart:b[0];a.selectionEnd=b[1]===null?a.selectionEnd:b[1]==-1?a.value.length:b[1];return jQuery(a)}||document.selection&&function(){var c=jQuery(a).getSelection();var d=b[0]===null?c.start:b[0];var f=b[1]===null?c.end:b[1]==-1?a.value.length:b[1];var g=document.selection.createRange();var h=a.createTextRange();h.moveStart("character",b[0]===null?c.start:b[0]);h.moveEnd("character",b[1]===null?-(a.value.length-c.end):b[1]==-1?0:-(a.value.length-b[1]));g.moveToBookmark(h.getBookmark());g.select();return jQuery(a)}||function(){return jQuery(a)})()},replaceSelection:function(){var a=this.jquery?this[0]:this;var b=arguments[0]||"";var c=arguments[1]||false;return("selectionStart"in a&&function(){a.focus();var d=a.selectionStart;a.value=a.value.substr(0,a.selectionStart)+b+a.value.substr(a.selectionEnd,a.value.length);if(c){a.setSelectionRange(d,d+b.length)}return jQuery(a)}||document.selection&&function(){a.focus();var d=document.selection.createRange();d.text=b;if(!c){d.collapse(false);d.select()}return jQuery(a)}||function(){a.value+=b;return jQuery(a)})()}};jQuery.each(b,function(a){jQuery.fn[a]=this})})()

function codebox(a){var b=a.keyCode||a.charCode;if(b==9){a.preventDefault();var c="  ";var d=$(this).getSelection();var e=d.start;$(this).replaceSelection(c);$(this).setSelection({pos:e+c.length});return}if(b!=13)return true;a.preventDefault();var d=$(this).getSelection();var e=d.start;var f=$(this).val().substr(0,e);f=f.match(/(^|\n)([ ]*)[^\n]*$/);f=f[2];f="\n"+f;$(this).replaceSelection(f);$(this).setSelection({pos:e+f.length})}$(function(){$("textarea.codebox").keydown(codebox)})
